<!-- Dashboard Content -->
<div class="row">
    <!-- Statistics Cards -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <i class="fas fa-server fa-2x mb-3"></i>
                <div class="stats-number"><%= stats.totalNodes %></div>
                <div class="stats-label">Total Servers</div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <i class="fas fa-wifi fa-2x mb-3"></i>
                <div class="stats-number"><%= stats.onlineNodes %></div>
                <div class="stats-label">Online Servers</div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <i class="fas fa-users fa-2x mb-3"></i>
                <div class="stats-number"><%= stats.totalUsers %></div>
                <div class="stats-label">Total Users</div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card h-100">
            <div class="card-body text-center">
                <i class="fas fa-key fa-2x mb-3"></i>
                <div class="stats-number"><%= stats.totalPreauthKeys %></div>
                <div class="stats-label">Preauth Keys</div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-line"></i>
                    Server Status Overview
                </h5>
            </div>
            <div class="card-body">
                <canvas id="serverStatusChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-pie"></i>
                    Network Distribution
                </h5>
            </div>
            <div class="card-body">
                <canvas id="networkChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="/users/create" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus"></i>
                            Add New User
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/nodes" class="btn btn-info w-100">
                            <i class="fas fa-server"></i>
                            Manage Servers
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/status" class="btn btn-warning w-100">
                            <i class="fas fa-heartbeat"></i>
                            System Status
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/monitoring" class="btn btn-success w-100">
                            <i class="fas fa-chart-line"></i>
                            View Metrics
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-clock"></i>
                    Recent Activity
                </h5>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker bg-success"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">System Started</h6>
                            <p class="text-muted mb-0">Headscale server is running normally</p>
                            <small class="text-muted">Just now</small>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-info"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">Database Connected</h6>
                            <p class="text-muted mb-0">PostgreSQL connection established</p>
                            <small class="text-muted">2 minutes ago</small>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-warning"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">API Key Generated</h6>
                            <p class="text-muted mb-0">New API key created for admin access</p>
                            <small class="text-muted">5 minutes ago</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle"></i>
                    System Alerts
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-success mb-3">
                    <i class="fas fa-check-circle"></i>
                    <strong>All systems operational</strong><br>
                    <small>No critical issues detected</small>
                </div>
                
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle"></i>
                    <strong>Monitoring active</strong><br>
                    <small>Prometheus and Grafana running</small>
                </div>
                
                <div class="alert alert-warning mb-0">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>SSL Certificate</strong><br>
                    <small>Certificate expires in 30 days</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS for timeline -->
<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -35px;
    top: 5px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.timeline-content {
    padding-left: 15px;
}

.timeline-content h6 {
    margin-bottom: 5px;
    color: #333;
}

.timeline-content p {
    margin-bottom: 5px;
    font-size: 0.9rem;
}

.timeline-content small {
    font-size: 0.8rem;
}
</style>

<!-- Chart.js Scripts -->
<script>
// Server Status Chart
const serverStatusCtx = document.getElementById('serverStatusChart').getContext('2d');
const serverStatusChart = new Chart(serverStatusCtx, {
    type: 'line',
    data: {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
        datasets: [{
            label: 'Online Servers',
            data: [<%= stats.onlineNodes %>, <%= stats.onlineNodes %>, <%= stats.onlineNodes %>, <%= stats.onlineNodes %>, <%= stats.onlineNodes %>, <%= stats.onlineNodes %>, <%= stats.onlineNodes %>],
            borderColor: '#198754',
            backgroundColor: 'rgba(25, 135, 84, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: <%= stats.totalNodes %>
            }
        }
    }
});

// Network Distribution Chart
const networkCtx = document.getElementById('networkChart').getContext('2d');
const networkChart = new Chart(networkCtx, {
    type: 'doughnut',
    data: {
        labels: ['Online', 'Offline'],
        datasets: [{
            data: [<%= stats.onlineNodes %>, <%= stats.totalNodes - stats.onlineNodes %>],
            backgroundColor: ['#198754', '#dc3545'],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// Real-time updates via Socket.IO
socket.on('stats_update', (newStats) => {
    // Update statistics cards
    document.querySelectorAll('.stats-number')[0].textContent = newStats.totalNodes;
    document.querySelectorAll('.stats-number')[1].textContent = newStats.onlineNodes;
    document.querySelectorAll('.stats-number')[2].textContent = newStats.totalUsers;
    document.querySelectorAll('.stats-number')[3].textContent = newStats.totalPreauthKeys;
    
    // Update charts
    serverStatusChart.data.datasets[0].data = [newStats.onlineNodes, newStats.onlineNodes, newStats.onlineNodes, newStats.onlineNodes, newStats.onlineNodes, newStats.onlineNodes, newStats.onlineNodes];
    serverStatusChart.update();
    
    networkChart.data.datasets[0].data = [newStats.onlineNodes, newStats.totalNodes - newStats.onlineNodes];
    networkChart.update();
});
</script>
